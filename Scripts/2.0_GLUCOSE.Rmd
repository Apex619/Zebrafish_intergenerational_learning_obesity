---
title: "Glucose"
author: "Hamza"
date: "23/11/2020"
output: html_document
---

### Load packages
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#checks for installation and loads packages
pacman::p_load(lmerTest,ggThemeAssist,rptR,lme4,readxl, tidyr, dplyr, magrittr, lubridate, stringr, purrr,
               sjPlot,ggplot2,lubridate,wesanderson,ggbeeswarm,emmeans,patchwork,viridis,nlme,Rmisc,ggpubr,
               stargazer)

#load('myEnvironment.RData')
```

```{r}
#Import data
Glucose <- read.csv("../Data/Glucose/Glucose_Data.csv") #check this works, issues with file directories
str(Glucose)

#Check structure
str(Glucose)
Glucose$Meter <- as.factor(Glucose$Meter)

hist(Glucose$Glucose)
#Very high reading confirmed to be correct



glucose_f1 <- ggplot(Glucose, aes(x=Group, y=Glucose, fill = Group)) + 
  geom_violin()+
  geom_jitter(height = 0, width = 0.1)

glucose_f1


Repeatability_Glucose <- rpt(Glucose ~ Meter + Sex + Group + (1 | Fish_ID), grname = "Fish_ID", data = Glucose, datatype = "Gaussian", 
                           nboot = 1000, npermut = 1000)

Repeatability_Glucose

Mixed_Model_Glucose <- lmer(Glucose ~ Group + Sex + Weight + (1|Fish_ID), data=Glucose)
summary(Mixed_Model_Glucose)
tab_model(Mixed_Model_Glucose)
hist(residuals(Mixed_Model_Glucose)) #Transform ?


# Calculating difference in variance between control and treatment group 
Model_Glucose_1 <- lme(Glucose ~ Group + Sex, random = ~ 1| Fish_ID, data = Glucose, na.action = na.omit) #Mixed model without variance structure
summary(Model_Glucose_1)
Model_Glucose_2 <- lme(Glucose ~ Group + Sex, random = ~ 1| Fish_ID, weights = varIdent(form=~1|Group), data = Glucose, na.action = na.omit) #mixed model with variance structure varIdent
summary(Model_Glucose_2)
anova(Model_Glucose_1, Model_Glucose_2)

```

