---
title: "04_Results"
author: "Hamza"
date: "10/02/2020"
output:
  html_document: default
  pdf_document: default
---

```{r load packages, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#knitr::opts_knit$set(root.dir = '/Users/dominicmason/OneDrive\ -\ UNSW/hons') #sets WD as project for all chunks - doesn't change directory for setup chunk
#install.packages("pacman")
#install.packages("ggThemeAssist")
#install.packages("ggbeeswarm")
#install.packages("rptR")
#install.packages("lme4")
#install.packages("lmerTest")
#install.packages("wesanderson")
library(lmerTest)
library(ggThemeAssist)
library(rptR)
library(lme4)
#library(contrast)
#install.packages("sjPlot")
library(sjPlot)
#install.packages("DataExplorer") 
#library(DataExplorer)
library(plyr)
library(emmeans)
library(patchwork)
library(dplyr)

pacman::p_load(readxl, tidyr, dplyr, magrittr, lubridate, stringr, purrr)

library(ggplot2)
library(lubridate)
library(wesanderson)
library(ggbeeswarm)

p2cs <- readRDS(file = "p2cs.rds") #MAKE SURE TO UPDATE THE .RDS file once all experiments are over !!!
p2cs_half <- readRDS(file = "p2cs_half.rds")
p2cs_second_half <- readRDS(file = "p2cs_second_half.rds")
p2cs_third_half <- readRDS(file = "p2cs_third_half.rds")#Such a stupid name, change !!! lol
p2cs_fourth_week <- readRDS(file = "p2cs_third_week.rds")
```
### Research Questions
1. Is there a difference in learning abilities across our four F1 conditions (Maternal, Paternal, Within Control & Within Treatment) ?
2. If so, which group is considered the 'smartest' (strong learners) and which group is considered the 'dumbest' (weak learners) ?

### Hypotheses

F1 fish whose parents were not exposed to a high fat diet (HFD) will be the strongest learners, while F1 fish whose BOTH parents were exposed, will be the weakest. Maternal tanks shouls also display weak learning, as there is plenty of evidence in the literature that maternal HFD result in cognitive impairment in offspring. 
We assessed learning by observing the difference between the baseline period (before conditioning with the electric shock) and the probe period (after the conditioning) for the conditioned stimulus (blue colour). The less time spent in the blue colour during the probe period indicates the fish learnt to associate that colour with the shock and actively avoid it. The 'smartest' fish would therefore have the highest baseline-probe difference. 

### Notes
I controlled for days, as well as time of day. Tanks were also pseudorandomized.

### Exploratory Data Analysis
```{r, echo = FALSE}
# Boxplot, Density plot and Histogram of overall results
cdat <- ddply(p2cs, "Tank", summarise, rating.mean=mean(difference))
cdat

ggplot(data = p2cs, mapping = aes(x = difference, fill = Tank )) + 
  geom_density(alpha=.3)+
    geom_vline(data=cdat, aes(xintercept=rating.mean,  colour=Tank),
               linetype="dashed", size=1)+
  labs(title = "Density plots with means")

ggplot(data = p2cs, mapping = aes(x = difference, fill = Tank )) + 
  geom_density(alpha=.3)+
 facet_grid(~sex)

ggplot(data = p2cs, mapping = aes(x = Tank, y = difference, fill = Tank )) + 
    geom_boxplot()+
  facet_grid(~sex)




ggplot(data = p2cs, mapping = aes(x = difference, fill = Tank )) + 
  geom_histogram()+
  facet_grid(~sex)

p2cs %>% 
  ggplot(aes(x = Tank, y = difference, colour = Tank)) +
  geom_violin(alpha = 0.1, draw_quantiles = c(0.25, 0.5, 0.75)) + 
  geom_jitter(width = 0.2, height = 0, alpha = 0.2) +
  theme_minimal()+
  facet_grid(~sex)
```

### Mixed Models
Using all of the baseline data, and then the first 2 mins of the probe data (baseline data has been standardized). I also created contrasts to examine whether or not there are differences between certain conditons themselves. 

NOTES: 

1. No interaction between tank and tod, also there was no effect of the day and sex, so we removed from the model

2. Also included a Log transformed model (however the residuals and qqplot indicate that this isn't necessary ?)

```{r, echo = FALSE, warning = FALSE}
model <- lmer(difference ~ Tank + sex + (1 | fishID), data = p2cs)
plot(model)
qqnorm(resid(model))
summary(model)
tab_model(model)
```

### Contrasts - overall model
```{r, echo = FALSE}

#Contrasts 
em_tank <- emmeans(model, ~ Tank) 
pairs(em_tank)



```



### Week 1 vs Week 2 
I compiled plots to examine the data from the first week and second week, as well as linear models.

```{r, echo = FALSE}
First_Half <- ggplot(p2cs_half, aes(sex, difference, color=sex)) + 
  geom_quasirandom(dodge.width=0.01, alpha=0.77)+
facet_grid(~Tank)+
  labs(title = "First Week")

First_Half_box <- ggplot(p2cs_half, aes(sex, difference, color=sex)) + 
  geom_boxplot()+
facet_grid(~Tank)+
    labs(title = "First Week")


Second_Half <- ggplot(p2cs_second_half, aes(sex, difference, color=sex)) + 
  geom_quasirandom(dodge.width=0.01, alpha=0.77)+
facet_grid(~Tank)+
   labs(title = "Second Week")

Second_Half_box <- ggplot(p2cs_second_half, aes(sex, difference, color=sex)) + 
  geom_boxplot()+
facet_grid(~Tank)+
     labs(title = "Second Week")

First_Half + Second_Half + plot_layout(ncol=,nrow = 2, heights = 100)

First_Half_box + Second_Half_box + plot_layout(ncol=,nrow = 2, heights = 100)

#Linear models
model_half <- lm(difference ~ Tank, data = p2cs_half)
#tod, day and sex aren't significant, so removed
summary(model_half)
tab_model(model_half)
#em_half_tod <- emmeans(model_half, ~ tod)
#pairs(em_half_tod)
em_half_tank <- emmeans(model_half, ~Tank)
pairs(em_half_tank)

model_second_half <- lm(difference ~ Tank + tod, data = p2cs_second_half)
#sex, day not significant, removed from the modek, interaction between tod and tank also insignificant
summary(model_second_half)
tab_model(model_second_half)
em_secondhalf_tod <- emmeans(model_second_half, ~ tod)
pairs(em_secondhalf_tod)
em_secondhalf_tank <- emmeans(model_second_half, ~Tank)
pairs(em_secondhalf_tank)
```


### Third Week

```{r}
Third_Half <- ggplot(p2cs_third_half, aes(sex, difference, color=sex)) + 
  geom_quasirandom(dodge.width=0.01, alpha=0.77)+
facet_grid(~Tank)+
  labs(title = "Third Week")
Third_Half


model_third_half <- lm(difference ~ Tank + sex, data = p2cs_third_half)
tab_model(model_third_half)
summary(model_third_half)
contrast_3 <- emmeans(model_third_half, ~Tank)
pairs(contrast_3)


third_week_summary <- p2cs_third_half %>% # the names of the new data frame and the data frame to be summarised
  group_by(sex, Tank) %>%   # the grouping variable
  summarise(mean = mean(difference),  # calculates the mean of each group
            sd = sd(difference), # calculates the standard deviation of each group
            n = n(),  # calculates the sample size per group
            SE = sd(difference)/sqrt(n())) # calculates the standard error of each group

third_week_plot <- ggplot(third_week_summary, aes(Tank, mean)) + 
                   geom_col() +  
                   geom_errorbar(aes(ymin = mean - SE, ymax = mean + SE), width=0.2)+
  facet_grid(~sex)

third_week_plot + labs(y="difference Â± s.e.", x = "Tank") + theme_classic()
```

### Fourth Week
```{r}
Fourth_Week <- ggplot(p2cs_fourth_week, aes(sex, difference, color=sex)) + 
  geom_quasirandom(dodge.width=0.01, alpha=0.77)+
facet_grid(~Tank)+
  labs(title = "Fourth Week")
Fourth_Week

model_fourth_week <- lm(difference ~ Tank + sex, data = p2cs_fourth_week)
tab_model(model_fourth_week)
summary(model_fourth_week)
contrast_4 <- emmeans(model_fourth_week, ~Tank)
pairs(contrast_4)
```



